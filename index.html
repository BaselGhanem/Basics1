<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X Academy - Professional Excel Course</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'x-primary': '#107c41',      /* Ù„ÙˆÙ† Ø¥ÙƒØ³Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠ */
                        'x-dark': '#0b5c30',
                        'x-accent': '#fbbf24',       /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ */
                        'bg-soft': '#f8fafc',
                        'grid-line': '#e2e8f0'
                    },
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'slide-in': 'slideIn 0.5s ease-out',
                        'shake': 'shake 0.4s cubic-bezier(.36,.07,.19,.97) both'
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)' }, '100%': { transform: 'scale(1)' } },
                        slideIn: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f8fafc; }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¥ÙƒØ³Ù„ Ø§Ù„Ø®Ø§ØµØ© */
        .excel-grid {
            display: grid;
            border: 1px solid #d1d5db;
            background-color: #fff;
            overflow: hidden;
            border-radius: 6px;
        }
        .excel-row { display: flex; }
        .excel-cell {
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            padding: 8px 12px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 40px;
            position: relative;
        }
        .excel-header {
            background-color: #f3f4f6;
            font-weight: 700;
            color: #4b5563;
            justify-content: center;
        }
        /* Formula Bar Input */
        .formula-input {
            width: 100%;
            height: 100%;
            position: absolute;
            inset: 0;
            border: 2px solid #107c41;
            outline: none;
            text-align: center;
            font-family: 'Consolas', monospace;
            direction: ltr;
            background-color: #f0fdf4;
            font-weight: bold;
            color: #166534;
            box-shadow: 0 0 0 4px rgba(16, 124, 65, 0.1);
            z-index: 10;
        }
        .formula-input.error {
            border-color: #ef4444;
            background-color: #fef2f2;
            color: #991b1b;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
        }

        /* Toast Notification */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: white; padding: 12px 24px; rounded: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex; align-items: center; gap: 12px;
            border-radius: 12px; font-weight: bold; z-index: 9999;
            opacity: 0; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { border-right: 6px solid #107c41; color: #065f46; }
        .toast.error { border-right: 6px solid #ef4444; color: #991b1b; }

        .active-nav { background-color: #107c41; color: white; box-shadow: 0 4px 12px rgba(16, 124, 65, 0.3); }
        .code-block { font-family: 'Consolas', monospace; direction: ltr; background: #f1f5f9; padding: 2px 6px; rounded: 4px; color: #0f172a; border: 1px solid #cbd5e1; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="auth-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex justify-center items-center p-4">
        <div class="bg-white p-10 rounded-3xl shadow-2xl max-w-md w-full text-center animate-pop relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-x-primary to-x-accent"></div>
            <div class="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-6 text-x-primary shadow-sm">
                <i data-lucide="user-check" class="w-10 h-10"></i>
            </div>
            <h2 class="text-3xl font-black text-gray-800 mb-2">Ø­ÙŠØ§Ùƒ Ø§Ù„Ù„Ù‡ ÙŠØ§ Ù…Ø¹Ù„Ù…!</h2>
            <p class="text-gray-500 mb-8 leading-relaxed">Ø¹Ø´Ø§Ù† Ù†Ø¨Ù„Ø´ Ø´ØºÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆÙ†Ø·Ù„Ø¹Ù„Ùƒ Ø´Ù‡Ø§Ø¯Ø© Ù…Ø±ØªØ¨Ø© Ø¢Ø®Ø± Ø§Ù„Ø¯ÙˆØ±Ø©ØŒ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø­Ù„Ùˆ.</p>
            <form id="login-form" class="space-y-4">
                <input type="text" id="username-input" class="w-full p-4 bg-gray-50 border-2 border-gray-200 rounded-xl text-center font-bold text-lg focus:border-x-primary focus:bg-white focus:ring-4 focus:ring-green-50 outline-none transition-all" placeholder="Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§..." required autocomplete="off">
                <button type="submit" class="w-full bg-x-primary hover:bg-x-dark text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1 flex justify-center items-center gap-2">
                    <span>ÙŠÙ„Ø§ Ù†Ø¨Ù„Ø´ Ø§Ù„Ø±Ø­Ù„Ø©</span> <i data-lucide="arrow-left"></i>
                </button>
            </form>
        </div>
    </div>

    <div id="toast-box" class="toast"></div>

    <header class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-3 cursor-pointer" onclick="renderPage('home')">
                    <div class="bg-gradient-to-br from-x-primary to-emerald-600 text-white w-10 h-10 rounded-lg flex items-center justify-center shadow-lg font-black text-xl">X</div>
                    <div class="flex flex-col">
                        <span class="font-black text-xl text-gray-800 tracking-tight leading-none">Academy</span>
                        <span class="text-xs font-bold text-x-primary tracking-wide">Professional Edition</span>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <div id="user-display" class="hidden md:flex items-center gap-2 bg-green-50 px-4 py-1.5 rounded-full border border-green-100">
                        <i data-lucide="user" class="w-4 h-4 text-x-primary"></i>
                        <span id="header-name" class="font-bold text-sm text-x-primary">Ø²Ø§Ø¦Ø±</span>
                    </div>
                    <button onclick="toggleLang()" class="flex items-center gap-2 px-3 py-1.5 rounded-lg border border-gray-200 hover:bg-gray-50 text-sm font-bold text-gray-600 transition">
                        <i data-lucide="globe" class="w-4 h-4"></i> <span id="lang-btn">EN</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto w-full flex-grow flex flex-col lg:flex-row p-4 gap-6 mt-4">
        
        <aside class="w-full lg:w-72 bg-white rounded-2xl shadow-sm border border-gray-100 p-5 h-fit lg:sticky lg:top-24 flex flex-col gap-6">
            <div class="flex flex-col items-center justify-center relative py-2">
                <div class="relative w-28 h-28">
                    <svg class="w-full h-full transform -rotate-90">
                        <circle cx="56" cy="56" r="48" fill="none" stroke="#f1f5f9" stroke-width="8"/>
                        <circle id="progress-ring" cx="56" cy="56" r="48" fill="none" stroke="#107c41" stroke-width="8" stroke-dasharray="301" stroke-dashoffset="301" stroke-linecap="round" class="transition-all duration-1000 ease-out"/>
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span id="progress-percent" class="text-2xl font-black text-gray-800">0%</span>
                        <span class="text-[10px] font-bold text-gray-400 uppercase">Ø¥Ù†Ø¬Ø§Ø²</span>
                    </div>
                </div>
            </div>

            <nav id="nav-menu" class="space-y-2 flex-grow"></nav>

            <div class="pt-4 border-t border-gray-100 text-center">
                <p class="text-xs text-gray-400 font-medium">Developed by X Academy Team</p>
            </div>
        </aside>

        <main id="content-area" class="flex-grow bg-white rounded-2xl shadow-sm border border-gray-100 min-h-[70vh] p-8 animate-slide-in relative overflow-hidden">
            </main>

    </div>

    <div id="cert-modal" class="fixed inset-0 bg-black/80 z-[100] hidden justify-center items-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-4xl p-1 relative shadow-2xl animate-pop">
            <button onclick="document.getElementById('cert-modal').classList.add('hidden')" class="absolute top-4 right-4 z-50 bg-gray-100 p-2 rounded-full hover:bg-red-100 hover:text-red-600 transition"><i data-lucide="x"></i></button>
            
            <div id="cert-canvas" class="bg-white p-16 text-center border-8 border-double border-x-primary relative overflow-hidden" dir="rtl">
                <div class="absolute top-0 left-0 w-32 h-32 bg-x-primary opacity-5 rounded-br-full"></div>
                <div class="absolute bottom-0 right-0 w-32 h-32 bg-x-primary opacity-5 rounded-tl-full"></div>

                <div class="relative z-10">
                    <div class="flex justify-center items-center gap-3 mb-8">
                        <div class="bg-x-primary text-white w-12 h-12 rounded-lg flex items-center justify-center font-black text-2xl shadow-md">X</div>
                        <h2 class="text-3xl font-black text-gray-800">X Academy</h2>
                    </div>

                    <h1 class="text-5xl font-black text-x-primary mb-4">Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… Ø¯ÙˆØ±Ø©</h1>
                    <p class="text-xl text-gray-500 font-medium mb-10">Mastering Excel Basics & Formulas</p>

                    <p class="text-2xl text-gray-700 mb-4">Ù†Ø´Ù‡Ø¯ Ø¨Ø£Ù†</p>
                    <div id="cert-user-name" class="text-6xl font-black text-gray-900 mb-8 pb-4 border-b-4 border-x-accent inline-block px-10">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</div>
                    
                    <p class="text-xl text-gray-600 leading-relaxed max-w-2xl mx-auto mb-12">
                        Ù‚Ø¯ Ø£ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ ÙƒØ§ÙØ© Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§ØªØŒ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø´Ø±Ø·ÙŠØŒ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØµÙˆØµØŒ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ.
                    </p>

                    <div class="flex justify-between items-end border-t border-gray-200 pt-8 mt-8">
                        <div class="text-right">
                            <p class="text-sm text-gray-400 font-bold mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ®</p>
                            <p id="cert-date" class="text-lg font-bold text-gray-800 font-mono">2025/10/10</p>
                        </div>
                        <div class="flex gap-2">
                             <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600"><i data-lucide="award" class="w-8 h-8"></i></div>
                        </div>
                        <div class="text-left">
                            <p class="text-sm text-gray-400 font-bold mb-1">Ø§Ù„Ù…Ø¯Ø±Ø¨</p>
                            <p class="text-lg font-bold text-gray-800 font-mono">Basel Ghanem</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-gray-50 rounded-b-2xl flex justify-center gap-4">
                <button onclick="downloadCert()" class="bg-x-primary hover:bg-x-dark text-white font-bold py-3 px-8 rounded-xl shadow-lg flex items-center gap-2 transition">
                    <i data-lucide="download"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© 
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const state = {
            lang: 'ar',
            user: null,
            currentView: 'home',
            completed: new Set(),
            score: 0
        };

        // --- Data Content (The "Full Fat" Content) ---
        const content = {
            ar: {
                nav: {
                    home: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
                    math: '1. Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©',
                    logic: '2. Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø´Ø±Ø·ÙŠ (IF)',
                    text: '3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØµÙˆØµ',
                    agg: '4. Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„ØªØ¬Ù…ÙŠØ¹',
                    quiz: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ'
                },
                home: {
                    title: 'Ø¯ÙˆØ±Ø© Ø§Ù„Ø¥ÙƒØ³Ù„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©',
                    desc: 'ØªØ¹Ù„Ù… Ø§Ù„Ø¥ÙƒØ³Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø©. Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù‡Ù†Ø§ØŒ Ø£Ù†Øª Ø³ØªÙƒØªØ¨ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨ÙŠØ¯Ùƒ ÙˆÙƒØ£Ù†Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ…Ø§Ù…Ø§Ù‹.',
                    cards: [
                        {icon: 'cpu', t: 'Ù…Ø­Ø§ÙƒØ§Ø© Ø°ÙƒÙŠØ©', d: 'Ù†Ø¸Ø§Ù… ÙŠÙÙ‡Ù… Ù…Ø¹Ø§Ø¯Ù„Ø§ØªÙƒ Ù…Ù‡Ù…Ø§ ÙƒØªØ¨ØªÙ‡Ø§'},
                        {icon: 'target', t: 'Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©', d: 'Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ù…Ù† Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù…Ù„'},
                        {icon: 'award', t: 'Ø´Ù‡Ø§Ø¯Ø© Ù…Ø¹ØªÙ…Ø¯Ø©', d: 'ØªØµØ¯Ø± ÙÙˆØ± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±'}
                    ],
                    btn: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„'
                },
                lessons: {
                    math: {
                        title: 'Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© ÙˆØ§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª',
                        desc: 'Ø£Ø³Ø§Ø³ Ø§Ù„Ø¥ÙƒØ³Ù„ Ù‡Ùˆ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª. Ø£Ù‡Ù… Ù‚Ø§Ø¹Ø¯Ø©: "Ø§Ù„Ø¶Ø±Ø¨ ÙˆØ§Ù„Ù‚Ø³Ù…Ø© Ø£Ù‚ÙˆÙ‰ Ù…Ù† Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„Ø·Ø±Ø­".',
                        examples: [
                            { code: '=5+10', txt: 'Ø¬Ù…Ø¹ Ø¨Ø³ÙŠØ·' },
                            { code: '=A1*B1', txt: 'Ø¶Ø±Ø¨ Ù‚ÙŠÙ… Ø®Ù„ÙŠØªÙŠÙ† (Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø®Ù„Ø§ÙŠØ§)' },
                            { code: '=(10+2)*5', txt: 'Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ ØªØ¬Ø¨Ø± Ø§Ù„Ø¥ÙƒØ³Ù„ ÙŠØ¬Ù…Ø¹ Ø£ÙˆÙ„Ø§Ù‹ (12) Ø«Ù… ÙŠØ¶Ø±Ø¨ Ø¨Ù€ 5 = 60' },
                            { code: '=10+2*5', txt: 'Ø¨Ø¯ÙˆÙ† Ø£Ù‚ÙˆØ§Ø³ØŒ Ø§Ù„Ø¶Ø±Ø¨ Ø£ÙˆÙ„Ø§Ù‹ (10) Ø«Ù… Ø§Ù„Ø¬Ù…Ø¹ = 20' }
                        ],
                        challenge: {
                            q: 'Ù„Ø¯ÙŠÙƒ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (500) ÙˆØ§Ù„Ø¹Ù„Ø§ÙˆØ© (100) ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© (50). Ø§Ø­Ø³Ø¨ "ØµØ§ÙÙŠ Ø§Ù„Ø±Ø§ØªØ¨" ÙÙŠ Ø§Ù„Ø®Ù„ÙŠØ© B4.',
                            hint: 'Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: (Ø§Ù„Ø±Ø§ØªØ¨ + Ø§Ù„Ø¹Ù„Ø§ÙˆØ©) - Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©.',
                            data: { A1:'Ø§Ù„Ø±Ø§ØªØ¨', B1:500, A2:'Ø§Ù„Ø¹Ù„Ø§ÙˆØ©', B2:100, A3:'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©', B3:50, A4:'Ø§Ù„ØµØ§ÙÙŠ', B4:null },
                            target: 'B4',
                            valid: ['=B1+B2-B3', '=(B1+B2)-B3']
                        }
                    },
                    logic: {
                        title: 'Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ù…Ù†Ø·Ù‚ ÙˆØ§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± (IF)',
                        desc: 'Ø¯Ø§Ù„Ø© IF Ù‡ÙŠ Ø§Ù„Ø¯Ù…Ø§Øº Ø§Ù„Ù…ÙÙƒØ±. Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ©: IF(Ø§Ù„Ø´Ø±Ø·, Ù„Ùˆ ØªØ­Ù‚Ù‚, Ù„Ùˆ Ù„Ù… ÙŠØªØ­Ù‚Ù‚).',
                        examples: [
                            { code: '=IF(A1>50,"Pass","Fail")', txt: 'Ø¥Ø°Ø§ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø£ÙƒØ¨Ø± Ù…Ù† 50 Ø§ÙƒØªØ¨ Ù†Ø§Ø¬Ø­ØŒ ØºÙŠØ± Ù‡ÙŠÙƒ Ø±Ø§Ø³Ø¨' },
                            { code: '=IF(B2="Yes",100,0)', txt: 'Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†ØµÙˆØµ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù‚ØªØ¨Ø§Ø³ ""' },
                            { code: '=IF(C1<0,"Negative","Positive")', txt: 'ÙØ­Øµ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø³Ø§Ù„Ø¨Ø© ÙˆØ§Ù„Ù…ÙˆØ¬Ø¨Ø©' }
                        ],
                        challenge: {
                            q: 'Ø§Ù„Ù…ÙˆØ¸Ù "Ø³Ø¹ÙŠØ¯" Ø­Ù‚Ù‚ Ù…Ø¨ÙŠØ¹Ø§Øª 12000. Ø§Ù„ØªØ§Ø±Ø¬Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ 10000. ÙÙŠ Ø§Ù„Ø®Ù„ÙŠØ© B3ØŒ Ø§ÙƒØªØ¨ Ù…Ø¹Ø§Ø¯Ù„Ø©: Ø§Ø°Ø§ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (B2) Ø£ÙƒØ¨Ø± Ø£Ùˆ ØªØ³Ø§ÙˆÙŠ 10000ØŒ Ø§ÙƒØªØ¨ "Bonus"ØŒ ØºÙŠØ± Ù‡ÙŠÙƒ Ø§ÙƒØªØ¨ "No".',
                            hint: 'ØªØ°ÙƒØ±: Ø§Ù„Ù†ØµÙˆØµ Ù…Ø«Ù„ "Bonus" Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ø¨ÙŠÙ† " ".',
                            data: { A1:'Ø§Ù„Ù…ÙˆØ¸Ù', B1:'Ø³Ø¹ÙŠØ¯', A2:'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', B2:12000, A3:'Ø§Ù„Ø­Ø§Ù„Ø©', B3:null },
                            target: 'B3',
                            valid: ['=IF(B2>=10000,"Bonus","No")', '=IF(B2>9999,"Bonus","No")']
                        }
                    },
                    text: {
                        title: 'Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†ØµÙˆØµ',
                        desc: 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙØµÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù…Ù‡Ø§Ø±Ø© Ø£Ø³Ø§Ø³ÙŠØ©.',
                        examples: [
                            { code: '=TEXTSPLIT(A1, " ")', txt: 'ÙØµÙ„ Ø§Ù„Ù†Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ© (Space)' },
                            { code: '=UPPER(A1)', txt: 'ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ù„Ø£Ø­Ø±Ù ÙƒØ¨ÙŠØ±Ø© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)' },
                            { code: '=TRIM(A1)', txt: 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© Ù…Ù† Ø§Ù„Ù†Øµ' }
                        ],
                        challenge: {
                            q: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ "Basel Ghanem" Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ B1. Ø§Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© Ù„ÙØµÙ„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø®Ù„ÙŠØ© B2 Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ©.',
                            hint: 'Ø§Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© TEXTSPLIT ÙˆØ§Ù„ÙØ§ØµÙ„ Ù‡Ùˆ " " (Ù…Ø³Ø§ÙØ©).',
                            data: { A1:'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„', B1:'Basel Ghanem', A2:'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„', B2:null },
                            target: 'B2',
                            valid: ['=TEXTSPLIT(B1," ")']
                        }
                    },
                    agg: {
                        title: 'Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„ØªØ¬Ù…ÙŠØ¹ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„',
                        desc: 'ØªÙ„Ø®ÙŠØµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¨Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ Ù…ÙÙŠØ¯.',
                        examples: [
                            { code: '=SUM(A1:A100)', txt: 'Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯' },
                            { code: '=AVERAGE(B1:B10)', txt: 'Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ (Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ)' },
                            { code: '=MAX(C1:C50)', txt: 'Ø¥ÙŠØ¬Ø§Ø¯ Ø£ÙƒØ¨Ø± Ù‚ÙŠÙ…Ø© (Ø£Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ Ù…Ø«Ù„Ø§Ù‹)' },
                            { code: '=COUNT(D1:D10)', txt: 'Ø¹Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø£Ø±Ù‚Ø§Ù…Ø§Ù‹ ÙÙ‚Ø·' }
                        ],
                        challenge: {
                            q: 'Ø§Ø­Ø³Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø«Ù„Ø§Ø«Ø© (Ù…Ù† B1 Ø¥Ù„Ù‰ B3) ÙˆØ¶Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ B4.',
                            hint: 'Ø§Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© SUM Ù„Ù„Ù†Ø·Ø§Ù‚.',
                            data: { A1:'ÙŠÙ†Ø§ÙŠØ±', B1:150, A2:'ÙØ¨Ø±Ø§ÙŠØ±', B2:200, A3:'Ù…Ø§Ø±Ø³', B3:350, A4:'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹', B4:null },
                            target: 'B4',
                            valid: ['=SUM(B1:B3)']
                        }
                    }
                },
                quiz: {
                    title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ',
                    q_list: [
                        { q: 'Ù„Ù„Ø¨Ø¯Ø¡ Ø¨Ø£ÙŠ Ù…Ø¹Ø§Ø¯Ù„Ø© ÙÙŠ Ø¥ÙƒØ³Ù„ØŒ Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø£ÙˆÙ„ØŸ', options: ['/', '=', '#'], a: '=' },
                        { q: 'Ø£ÙŠ Ø¯Ø§Ù„Ø© ØªØ³ØªØ®Ø¯Ù… Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØŸ', options: ['SUM', 'MAX', 'AVERAGE'], a: 'AVERAGE' },
                        { 
  q: 'ÙÙŠ Ø¯Ø§Ù„Ø© IFØŒ ÙƒÙŠÙ Ù†ÙƒØªØ¨ Ø§Ù„Ù†ØµÙˆØµØŸ', 
  options: ['Ø¨Ø¯ÙˆÙ† Ø´ÙŠØ¡', 'Ø¨ÙŠÙ† Ø£Ù‚ÙˆØ§Ø³', 'Ø¨ÙŠÙ† ØªÙ†ØµÙŠØµ'], 
  a: 'Ø¨ÙŠÙ† ØªÙ†ØµÙŠØµ' 
}
,
                        { q: 'Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù€ =10+2*5 Ù‡ÙŠ:', options: ['60', '20', '12'], a: '20' }
                    ],
                    btn: 'Ø§Ø¨Ø¹Ø« Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©'
                }
            },
            en: {
                nav: { home: 'Home', math: '1. Math Ops', logic: '2. Logic (IF)', text: '3. Text Funcs', agg: '4. Aggregation', quiz: 'Final Quiz' },
                home: {
                    title: 'Professional Excel Course',
                    desc: 'Learn by doing. No multiple choice here; you type the actual formulas just like real Excel.',
                    cards: [
                        {icon: 'cpu', t: 'Smart Simulation', d: 'Parses your formulas dynamically'},
                        {icon: 'target', t: 'Real Examples', d: 'Business scenarios'},
                        {icon: 'award', t: 'Certificate', d: 'Instant certification upon completion'}
                    ],
                    btn: 'Start First Lesson'
                },
                lessons: {
                    math: {
                        title: 'Lesson 1: Math & Order of Ops',
                        desc: 'Multiplication/Division happen before Addition/Subtraction.',
                        examples: [
                            { code: '=5+10', txt: 'Simple Add' },
                            { code: '=A1*B1', txt: 'Multiply Cells (Best Practice)' },
                            { code: '=(10+2)*5', txt: 'Parentheses first: 12*5 = 60' },
                            { code: '=10+2*5', txt: 'Mult first: 10+10 = 20' }
                        ],
                        challenge: {
                            q: 'Calculate Net Salary in B4: (Salary + Bonus) - Tax.',
                            hint: 'Formula: (B1 + B2) - B3',
                            data: { A1:'Salary', B1:500, A2:'Bonus', B2:100, A3:'Tax', B3:50, A4:'Net', B4:null },
                            target: 'B4',
                            valid: ['=B1+B2-B3', '=(B1+B2)-B3']
                        }
                    },
                    logic: {
                        title: 'Lesson 2: Logic (IF)',
                        desc: 'IF(Condition, Value if True, Value if False).',
                        examples: [
                            { code: '=IF(A1>50,"Pass","Fail")', txt: 'Pass if > 50' },
                            { code: '=IF(B2="Yes",100,0)', txt: 'Text must be in quotes' }
                        ],
                        challenge: {
                            q: 'Target is 10000. If Sales (B2) >= 10000, write "Bonus", else "No" in B3.',
                            hint: 'Remember quotes for "Bonus".',
                            data: { A1:'Emp', B1:'John', A2:'Sales', B2:12000, A3:'Status', B3:null },
                            target: 'B3',
                            valid: ['=IF(B2>=10000,"Bonus","No")']
                        }
                    },
                    text: {
                        title: 'Lesson 3: Text Functions',
                        desc: 'Cleaning and splitting text.',
                        examples: [
                            { code: '=TEXTSPLIT(A1, " ")', txt: 'Split by space' },
                            { code: '=UPPER(A1)', txt: 'Convert to uppercase' }
                        ],
                        challenge: {
                            q: 'Split the full name in B1 using the space delimiter into B2.',
                            hint: 'Use TEXTSPLIT function.',
                            data: { A1:'Full Name', B1:'Basel Ghanem', A2:'First Name', B2:null },
                            target: 'B2',
                            valid: ['=TEXTSPLIT(B1," ")']
                        }
                    },
                    agg: {
                        title: 'Lesson 4: Aggregation',
                        desc: 'Summarizing data.',
                        examples: [
                            { code: '=SUM(A1:A10)', txt: 'Sum range' },
                            { code: '=AVERAGE(B1:B10)', txt: 'Average' },
                            { code: '=MAX(C1:C10)', txt: 'Max value' }
                        ],
                        challenge: {
                            q: 'Sum the values from B1 to B3 into B4.',
                            hint: 'Use SUM function.',
                            data: { A1:'Jan', B1:150, A2:'Feb', B2:200, A3:'Mar', B3:350, A4:'Total', B4:null },
                            target: 'B4',
                            valid: ['=SUM(B1:B3)']
                        }
                    }
                },
                quiz: {
                    title: 'Final Quiz',
                    q_list: [
                        { q: 'Formulas start with:', options: ['+', '=', '#'], a: '=' },
                        { q: 'Function for average:', options: ['SUM', 'MAX', 'AVERAGE'], a: 'AVERAGE' },
                        { q: 'Text in formulas needs:', options: ['Nothing', 'Brackets', 'Quotes ""'], a: 'Quotes ""' },
                        { q: 'Result of =10+2*5:', options: ['60', '20', '12'], a: '20' }
                    ],
                    btn: 'Submit Answers'
                }
            }
        };

        // --- Core Functions ---

        function init() {
            // Check auth
            const modal = document.getElementById('auth-modal');
            modal.style.display = 'flex';
            lucide.createIcons();

            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('username-input').value.trim();
                if(name) {
                    state.user = name;
                    document.getElementById('header-name').textContent = name;
                    document.getElementById('cert-user-name').textContent = name;
                    modal.style.display = 'none';
                    renderSidebar();
                    renderPage('home');
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                }
            });
        }

        function toggleLang() {
            state.lang = state.lang === 'ar' ? 'en' : 'ar';
            document.documentElement.dir = state.lang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = state.lang;
            document.getElementById('lang-btn').textContent = state.lang === 'ar' ? 'EN' : 'Ø¹Ø±Ø¨ÙŠ';
            renderSidebar();
            renderPage(state.currentView);
        }

        function renderSidebar() {
            const T = content[state.lang].nav;
            const nav = document.getElementById('nav-menu');
            nav.innerHTML = '';

            const items = [
                { id: 'home', txt: T.home, icon: 'home' },
                { id: 'math', txt: T.math, icon: 'calculator' },
                { id: 'logic', txt: T.logic, icon: 'git-branch' },
                { id: 'text', txt: T.text, icon: 'type' },
                { id: 'agg', txt: T.agg, icon: 'sigma' },
                { id: 'quiz', txt: T.quiz, icon: 'award' }
            ];

            items.forEach(item => {
                const isDone = state.completed.has(item.id);
                const isActive = state.currentView === item.id;
                
                const btn = document.createElement('button');
                btn.className = `w-full px-4 py-3 rounded-xl flex items-center justify-between transition-all duration-200 group ${isActive ? 'active-nav' : 'hover:bg-gray-50 text-gray-600'}`;
                btn.onclick = () => renderPage(item.id);
                btn.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i data-lucide="${item.icon}" class="w-5 h-5"></i>
                        <span class="font-bold text-sm">${item.txt}</span>
                    </div>
                    ${isDone ? `<i data-lucide="check-circle" class="w-5 h-5 text-green-500 ${isActive ? 'text-white' : ''}"></i>` : ''}
                `;
                nav.appendChild(btn);
            });
            lucide.createIcons();
            updateProgress();
        }

        function updateProgress() {
            const total = 5; // 4 lessons + 1 quiz
            const current = state.completed.size;
            const pct = Math.round((current/total) * 100);
            
            document.getElementById('progress-percent').textContent = pct + '%';
            // Circumference of radius 48 is ~301
            document.getElementById('progress-ring').style.strokeDashoffset = 301 - (301 * pct / 100);
        }

        function renderPage(viewId) {
            state.currentView = viewId;
            renderSidebar(); // Update active state
            const area = document.getElementById('content-area');
            const T = content[state.lang];

            // Reset Animation
            area.classList.remove('animate-slide-in');
            void area.offsetWidth;
            area.classList.add('animate-slide-in');

            if (viewId === 'home') {
                const H = T.home;
                area.innerHTML = `
                    <div class="text-center max-w-3xl mx-auto py-10">
                        <div class="inline-block p-4 bg-green-50 rounded-3xl mb-6 shadow-sm">
                            <i data-lucide="sheet" class="w-16 h-16 text-x-primary"></i>
                        </div>
                        <h1 class="text-5xl font-black text-gray-900 mb-6">${H.title}</h1>
                        <p class="text-xl text-gray-500 mb-12 leading-relaxed">${H.desc}</p>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-12 text-start">
                            ${H.cards.map(c => `
                                <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100 hover:border-green-200 hover:shadow-md transition">
                                    <i data-lucide="${c.icon}" class="w-8 h-8 text-x-primary mb-3"></i>
                                    <h3 class="font-bold text-lg text-gray-800 mb-1">${c.t}</h3>
                                    <p class="text-sm text-gray-500">${c.d}</p>
                                </div>
                            `).join('')}
                        </div>

                        <button onclick="renderPage('math')" class="bg-x-primary hover:bg-x-dark text-white text-lg font-bold py-4 px-12 rounded-2xl shadow-xl hover:shadow-2xl transition transform hover:-translate-y-1 flex items-center gap-2 mx-auto">
                            ${H.btn} <i data-lucide="${state.lang === 'ar' ? 'arrow-left' : 'arrow-right'}"></i>
                        </button>
                    </div>
                `;
            } else if (viewId === 'quiz') {
                renderQuiz(area, T.quiz);
            } else {
                renderLesson(area, T.lessons[viewId], viewId);
            }
            lucide.createIcons();
        }

        function renderLesson(container, data, lessonId) {
            // Build Examples HTML
            const examplesHTML = data.examples.map(ex => `
                <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="bg-white p-1.5 rounded border border-gray-300 font-mono text-xs font-bold text-x-primary shrink-0" dir="ltr">${ex.code}</div>
                    <p class="text-sm text-gray-700 pt-0.5 font-medium">${ex.txt}</p>
                </div>
            `).join('');

            // Build Challenge Grid
            let gridRows = '';
            for(let i=1; i<=4; i++) {
                gridRows += `
                    <tr class="h-10">
                        <td class="bg-gray-100 text-gray-500 font-bold text-xs border border-gray-300 text-center w-8">${i}</td>
                        <td class="border border-gray-200 bg-white text-center text-sm px-2 text-gray-600">${data.challenge.data['A'+i] || ''}</td>
                        <td class="border border-gray-200 bg-white text-center text-sm font-bold text-gray-800 relative p-0">
                            ${'B'+i === data.challenge.target 
                                ? `<input id="user-formula" class="formula-input" placeholder="fx..." autocomplete="off">` 
                                : (data.challenge.data['B'+i] !== null ? data.challenge.data['B'+i] : '')}
                        </td>
                    </tr>
                `;
            }

            container.innerHTML = `
                <div class="max-w-5xl mx-auto">
                    <div class="mb-8 border-b border-gray-100 pb-6">
                        <span class="bg-green-100 text-x-dark px-3 py-1 rounded-full text-xs font-bold mb-3 inline-block">ØªØ¹Ù„Ù… ÙˆÙ…Ø§Ø±Ø³</span>
                        <h2 class="text-3xl font-black text-gray-900 mb-3">${data.title}</h2>
                        <p class="text-lg text-gray-500">${data.desc}</p>
                    </div>

                    <div class="grid lg:grid-cols-2 gap-10">
                        <div>
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2"><i data-lucide="book" class="text-x-primary"></i> Ø´Ø±Ø­ ÙˆØ£Ù…Ø«Ù„Ø©</h3>
                            <div class="space-y-3 mb-6">
                                ${examplesHTML}
                            </div>
                            
                            <div class="bg-blue-50 p-5 rounded-2xl border border-blue-100">
                                <h4 class="font-bold text-blue-800 mb-2 text-sm flex items-center gap-2"><i data-lucide="info" class="w-4"></i> Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h4>
                                <p class="text-gray-700 text-sm leading-relaxed">${data.challenge.q}</p>
                                <div class="mt-3 text-xs bg-white p-2 rounded border border-blue-200 text-blue-600 inline-block font-bold">
                                    ğŸ’¡ ØªÙ„Ù…ÙŠØ­: ${data.challenge.hint}
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-100 p-1 rounded-2xl shadow-inner border border-gray-200">
                            <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-300">
                                <div class="bg-gray-50 border-b border-gray-300 flex items-center px-2 py-1 gap-2">
                                    <div class="flex gap-1">
                                        <div class="w-2.5 h-2.5 rounded-full bg-red-400"></div>
                                        <div class="w-2.5 h-2.5 rounded-full bg-yellow-400"></div>
                                        <div class="w-2.5 h-2.5 rounded-full bg-green-400"></div>
                                    </div>
                                    <div class="h-4 w-px bg-gray-300 mx-2"></div>
                                    <span class="text-xs font-bold text-gray-400 italic font-serif">fx</span>
                                    <div id="formula-bar-mirror" class="flex-grow bg-white border border-gray-200 h-6 rounded text-xs px-2 flex items-center font-mono text-gray-500"></div>
                                </div>

                                <div class="flex bg-gray-100 border-b border-gray-300">
                                    <div class="w-8 border-r border-gray-300"></div>
                                    <div class="flex-1 text-center text-xs font-bold text-gray-500 py-1 border-r border-gray-300">A</div>
                                    <div class="flex-1 text-center text-xs font-bold text-gray-500 py-1">B</div>
                                </div>

                                <table class="w-full border-collapse">
                                    ${gridRows}
                                </table>
                            </div>
                            
                            <div class="mt-4 flex justify-between items-center px-2">
                                <span id="feedback-msg" class="text-sm font-bold text-gray-500">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©...</span>
                                <button onclick="checkAnswer('${lessonId}')" class="bg-gray-800 hover:bg-black text-white px-6 py-2 rounded-lg font-bold text-sm shadow-md transition">ØªØ­Ù‚Ù‚</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Input Mirroring logic
            const input = document.getElementById('user-formula');
            const mirror = document.getElementById('formula-bar-mirror');
            if(input){
                input.addEventListener('input', (e) => {
                    mirror.textContent = e.target.value;
                });
                input.addEventListener('keydown', (e) => {
                    if(e.key === 'Enter') checkAnswer(lessonId);
                });
            }
        }

        function checkAnswer(lessonId) {
            const input = document.getElementById('user-formula');
            const feedback = document.getElementById('feedback-msg');
            const lessonData = content[state.lang].lessons[lessonId].challenge;
            
            // Normalize: Remove spaces, Uppercase
            const userVal = input.value.replace(/\s/g, '').toUpperCase();
            const validAnswers = lessonData.valid.map(v => v.replace(/\s/g, '').toUpperCase());

            if (validAnswers.includes(userVal)) {
                // Success
                input.classList.remove('error');
                input.style.backgroundColor = '#dcfce7';
                input.style.color = '#15803d';
                input.disabled = true;
                
                feedback.textContent = "ÙƒÙÙˆ! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…";
                feedback.className = "text-sm font-bold text-green-600";
                
                state.completed.add(lessonId);
                updateProgress();
                confetti({ particleCount: 60, spread: 70, origin: { y: 0.7 } });
                showToast("Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø§Ø³ØªÙ…Ø±", "success");

                // Determine Next Step
                const keys = Object.keys(content[state.lang].lessons);
                const currIdx = keys.indexOf(lessonId);
                if (currIdx < keys.length - 1) {
                    setTimeout(() => renderPage(keys[currIdx + 1]), 1500);
                } else {
                    setTimeout(() => renderPage('quiz'), 1500);
                }

            } else {
                // Error
                input.classList.add('error');
                input.classList.add('animate-shake');
                setTimeout(() => input.classList.remove('animate-shake'), 500);
                feedback.textContent = "Ø®Ø·Ø£.. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØµÙŠØºØ© âŒ";
                feedback.className = "text-sm font-bold text-red-600";
                showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©", "error");
            }
        }

        function renderQuiz(container, data) {
            container.innerHTML = `
                <div class="max-w-2xl mx-auto py-8">
                    <div class="text-center mb-10">
                        <span class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold mb-3 inline-block">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©</span>
                        <h2 class="text-4xl font-black text-gray-900">${data.title}</h2>
                    </div>

                    <div class="space-y-6">
                        ${data.q_list.map((q, i) => `
                            <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200">
                                <p class="font-bold text-lg text-gray-800 mb-4">${i+1}. ${q.q}</p>
                                <div class="grid grid-cols-1 gap-3">
                                    ${q.options.map(opt => `
                                        <label class="flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-xl cursor-pointer hover:border-x-primary hover:bg-green-50 transition-all group">
                                            <input type="radio" name="q${i}" value="${opt}" class="w-5 h-5 accent-x-primary group-hover:scale-110 transition">
                                            <span class="text-gray-600 font-medium group-hover:text-x-primary">${opt}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <button onclick="submitQuiz()" class="w-full mt-10 bg-x-primary hover:bg-x-dark text-white font-bold py-5 rounded-2xl shadow-xl text-xl transition transform hover:-translate-y-1">
                        ${data.btn}
                    </button>
                </div>
            `;
        }

        function submitQuiz() {
            const data = content[state.lang].quiz.q_list;
            let correctCount = 0;

            data.forEach((q, i) => {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if(selected && selected.value === q.a) correctCount++;
            });

            if (correctCount === data.length) {
                state.completed.add('quiz');
                updateProgress();
                confetti({ particleCount: 300, spread: 180 });
                
                // Show Certificate Modal
                const today = new Date().toLocaleDateString('en-GB');
                document.getElementById('cert-date').textContent = today;
                document.getElementById('cert-modal').classList.remove('hidden');
                document.getElementById('cert-modal').classList.add('flex');
            } else {
                showToast(`Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${correctCount} Ù…Ù† ${data.length}. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!`, 'error');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function downloadCert() {
            const el = document.getElementById('cert-canvas');
            html2canvas(el, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Certificate_${state.user}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function showToast(msg, type) {
            const box = document.getElementById('toast-box');
            box.innerHTML = type === 'success' 
                ? `<i data-lucide="check-circle" class="w-5"></i> ${msg}`
                : `<i data-lucide="alert-triangle" class="w-5"></i> ${msg}`;
            box.className = `toast ${type} show`;
            lucide.createIcons();
            
            setTimeout(() => {
                box.classList.remove('show');
            }, 3000);
        }

        // Initialize App
        window.onload = init;

    </script>
</body>
</html>
